{
  "hash": "d6172999fca5b0aa80bf3c97b5addaf2",
  "result": {
    "markdown": "---\ntitle: 'Visualizing proportions'\nauthor: 'Jinwon Lee'\ndate: '2023-05-17'\ncategories: [Visualization, Code, R]\npage-layout: full\nimage: \"./image/proportion.png\"\noutput:\n  prettydoc::html_pretty:\n    theme: architect\n    highlight: github\neditor_options: \n  chunk_output_type: console\nmainfont: NanumGothic\n---\n\n\n# 10. Visualizing proportions - 비율 데이터의 시각화\n\n\n\n\n\n## 10.1 A case for pie charts - 파이 차트\n\n### Figure 10.1\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Data\nbundestag <- read.csv('./data/bundestag.csv')\nbundestag$party\n#> [1] \"CDU/CSU\" \"SPD\"     \"FDP\"\n\n# 시작: 12시, 시계 방향, 색상\nbund_pie <- bundestag %>%\n  arrange(seats) %>%\n  mutate(party_fac = factor(party, levels = party[order(seats)]),\n         value = seats,\n         ypos = sum(value) - (cumsum(value) - 0.5 * value), \n         mid_angle = 2 * pi * (ypos / sum(value)),\n         hjust = ifelse(mid_angle < pi, 1, 0),\n         vjust = ifelse(mid_angle < pi, mid_angle / pi, 2 - mid_angle / pi))\n\n# Visualization\nggplot(bund_pie, aes(x = '', y = seats, fill = party_fac)) +\n  geom_bar(stat = 'identity') +\n  geom_text(aes(x = 1, y = ypos, label = seats), color = 'white', size = 5) +\n  geom_text(aes(x = 1.5, y = ypos, label = party, hjust = hjust, vjust = vjust), color = 'black', size = 5) +\n  coord_polar(theta = 'y', start = 0, direction = -1, clip = 'off') + \n  scale_fill_manual(values = bund_pie$colors) +\n  theme_void() +\n  theme(legend.position = 'none')\n```\n\n::: {.cell-output-display}\n![](week12_Visualizing_proportions_files/figure-html/unnamed-chunk-1-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Figure 10.1 - Label + %\nbund_pie <- bundestag %>%\n  arrange(seats) %>%\n  mutate(party_fac = factor(party, levels = party[order(seats)]),\n         value = seats,\n         labs = paste(party, '\\n', round(value / sum(value) * 100, 0), '%', sep = ''),\n         ypos = sum(value) - (cumsum(value) - 0.5 * value),\n         mid_angle = 2 * pi * (ypos / sum(value)),\n         hjust = ifelse(mid_angle < pi, 1, 0),\n         vjust = ifelse(mid_angle < pi, mid_angle / pi, 2 - mid_angle / pi))\n\n# Visualization\nggplot(bund_pie, aes(x = '', y = seats, fill = party_fac)) +\n  geom_bar(stat = 'identity', color = 'white') +\n  geom_text(aes(x = 1, y = ypos, label = labs), size = 4) +\n  coord_polar(theta = 'y', start = 0, direction = -1, clip = 'off') +\n  scale_fill_brewer(palette = 'Set1') +\n  theme_void() +\n  theme(legend.position = 'none')\n```\n\n::: {.cell-output-display}\n![](week12_Visualizing_proportions_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\n### Figure 10.3\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbundestag %>% mutate(party = factor(party, levels = party)) %>%\n  ggplot(aes(x = party, y = seats, fill = party)) +\n  geom_col() +\n  geom_text(aes(label = seats), size = 5, vjust = 2, color = c('white', 'white', 'black')) +\n  scale_x_discrete(name = NULL) +\n  scale_y_continuous(expand = c(0, 0)) +\n  scale_fill_manual(values = bundestag$colors, guide = 'none') + \n  theme_light() +\n  theme(panel.border = element_blank(), \n        panel.grid.major.x = element_blank(),\n        panel.grid.minor.x = element_blank(), \n        panel.grid.minor.y = element_blank(), \n        axis.ticks.x = element_blank())\n```\n\n::: {.cell-output-display}\n![](week12_Visualizing_proportions_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\n## 10.2 A case for side-by-side bars - 병렬 막대 도표\n\n### Figure 10.6\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Data\nmarketshare <- read.csv('./data/marketshare.csv')\n\n# Visualization\nggplot(marketshare, aes(x = company, y = percent, fill = company)) +\n  geom_col() +\n  facet_wrap(~year) +\n  scale_y_continuous(name = 'Market Share',\n                     labels = scales::percent_format(scale = 1),\n                     expand = c(0, 0)) +\n  scale_fill_brewer(palette='Set2', guide = 'none') +\n  theme_classic() +\n  theme(strip.background = element_blank())\n```\n\n::: {.cell-output-display}\n![](week12_Visualizing_proportions_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\n## 10.3 A case for stacked bars and stacked densities - 누적 막대와 누적 밀도 도표\n\n### Figure 10.7\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Data\nwomen_parliaments <- read.csv('./data/women_parliaments.csv')\nwomen_parliaments %>% sapply(class)\n#>      country country_code         year   perc_women \n#>  \"character\"  \"character\"    \"integer\"    \"numeric\"\n\nwomen_rwanda <- women_parliaments %>%\n  filter(country_code == 'RWA' & year > 1990) %>%\n  mutate(women = perc_women,\n         men = 100 - perc_women) %>%\n  select(-perc_women) %>%\n  tidyr::gather(key = 'gender', value = 'percent', women, men) %>%\n  mutate(gender = factor(gender, levels = c('women', 'men')))\n\n# Visualization\nplot_base <- ggplot(women_rwanda, aes(x = year, y = percent, fill = gender)) +\n  geom_col(position = 'stack', width = 1, color = '#FFFFFF',\n           linewidth = .75, alpha = .8) +\n  geom_hline(yintercept = 50, color = '#000000FF',\n             linewidth = .4, linetype = 2) +\n  geom_hline(yintercept = 100, color = 'black') +\n  scale_x_continuous(expand = c(0, 0)) +\n  scale_y_continuous(name = 'Relative Proportion',\n                     labels = scales::percent_format(scale = 1),\n                     expand = c(0, 0)) +\n  scale_fill_manual(values = c('#D55E00E0', '#0072B2E0'), guide = 'none') +\n  theme_classic() +\n  theme(axis.line.y = element_blank())\n\nplot_base\n```\n\n::: {.cell-output-display}\n![](week12_Visualizing_proportions_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# calculate label position\nlabels <- filter(women_rwanda, year == max(year)) %>%\n  mutate(pos = 100 - cumsum(percent) + 0.5 * percent)\n\nyax <- axis_canvas(plot_base, axis = 'y') +\n  geom_text(data = labels, aes(y = pos, label = paste0(' ', gender)),\n            x = 0, hjust = 0, size = 14/.pt)\n\nggdraw(insert_yaxis_grob(plot_base, yax, grid::unit(.15, 'null')))\n```\n\n::: {.cell-output-display}\n![](week12_Visualizing_proportions_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n\n## 10.4 Visualizing proportions separately as parts of the total - 전체 대비 부분 비율의 표현\n\n### Figure 10.10\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Data\nhappy <- read.csv('./data/happy.csv')\nhappy %>% sapply(class)\n#>          id       happy        year         age         sex     marital \n#>   \"integer\" \"character\"   \"integer\"   \"integer\" \"character\" \"character\" \n#>      degree     finrela      health     wtssall \n#> \"character\" \"character\" \"character\"   \"numeric\"\n\ndf_marital <- select(happy, age, marital) %>%\n  na.omit() %>%\n  filter(marital != 'separated') %>%\n  mutate(marital = factor(marital, levels = c('widowed', 'divorced', 'married', 'never married')))\n\n# Visualization\n\n# color brewer 5-class PuBu\ncolors <- RColorBrewer::brewer.pal(5, 'PuBu')[5:1]\n\nggplot(df_marital, aes(x = age, y = after_stat(count),\n                       fill = marital, color = marital)) +\n  geom_density(position = 'fill') +\n  scale_x_continuous(name = 'Age (years)', expand = c(0, 0)) +\n  scale_y_continuous(name = 'Relative Proportion',\n                     labels = scales::percent, expand = c(0, 0)) +\n  scale_color_manual(values = colors, name = 'Marital Status') +\n  scale_fill_manual(values = colors, name = 'Marital Status') +\n  theme_classic() +\n  theme(axis.line.x = element_blank(),\n        axis.line.y = element_blank())\n```\n\n::: {.cell-output-display}\n![](week12_Visualizing_proportions_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\n### Figure 10.11\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf_marital %>%\n  mutate(marital = forcats::fct_rev(marital)) %>%\n  ggplot(aes(x = age, y = after_stat(count))) +\n  geom_density(data = select(df_marital, -marital),\n               aes(fill = 'All People Surveyed  '), color = 'transparent') +\n  geom_density(aes(fill = 'Highlighted Group'), color = 'transparent') +\n  facet_wrap(~marital, nrow = 1) +\n  scale_x_continuous(name = 'Age (years)', limits = c(15, 98), expand =c(0, 0)) +\n  scale_y_continuous(name = 'Count', expand = c(0, 0)) +\n  scale_fill_manual(values = c('#b3b3b3a0', '#2b8cbed0'),\n                    name = NULL,\n                    guide = guide_legend(direction = 'horizontal')) +\n  theme_classic() +\n  theme(panel.grid.major.y = element_line(colour = '#b3b3b3'),\n        axis.line.x = element_blank(),\n        axis.line.y = element_blank(),\n        strip.background = element_blank(),\n        strip.text = element_text(size = 14),\n        legend.position = 'bottom',\n        legend.justification = 'right')\n```\n\n::: {.cell-output-display}\n![](week12_Visualizing_proportions_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::",
    "supporting": [
      "week12_Visualizing_proportions_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}