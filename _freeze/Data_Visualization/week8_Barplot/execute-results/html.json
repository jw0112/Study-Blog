{
  "hash": "9809cba7a45cc3ab7e308fda202a1332",
  "result": {
    "markdown": "---\ntitle: 'Barplot'\nauthor: 'Jinwon Lee'\ndate: '2023-04-26'\ncategories: [Visualization, Code, R]\npage-layout: full\nimage: \"./image/barplot.png\"\noutput:\n  prettydoc::html_pretty:\n    theme: architect\n    highlight: github\neditor_options: \n  chunk_output_type: console\nmainfont: NanumGothic\n---\n\n\n\n\n# 6. Visualizing amounts: 수량 데이터의 시각화\n\n## 6.1. Barplots : 막대 도표의 다양한 활용\n\n### Figure 6.1 - 세로 막대\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Data Load\nboxoffice <- read.csv('./data/boxoffice.csv')\n\n# 세로 막대\nboxoffice %>%\n  ggplot(aes(x = fct_reorder(title, rank), y = amount)) +\n  geom_col(fill = '#56B4E9', width = 0.6, alpha = 0.9) +\n  scale_y_continuous(expand = c(0, 0),\n                     breaks = c(0, 2e7, 4e7, 6e7),\n                     labels = c('0', '20', '40', '60'),\n                     name = 'Weekend groos(million USD)') +\n  xlab('') +\n  theme_minimal() +\n  theme(axis.ticks.x = element_blank(),\n        panel.grid.major.x = element_blank())\n```\n\n::: {.cell-output-display}\n![](week8_Barplot_files/figure-html/unnamed-chunk-1-1.png){width=672}\n:::\n:::\n\n\n### 예제 - 실시간 예매율\n- https://www.kobis.or.kr/kobis/business/stat/boxs/findRealTicketList.do\n- 조회일: 2023-04-26\n- 출처: 영화진흥위원회 통합전산망 (http://www.kobis.or.kr)\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Data Load\nboxoffice_kor <- read.csv('./data/KOBIS_실시간_예매율_2023-04-26.csv')\n\n# 세로 막대\nboxoffice_kor %>%\n  filter(순위 <= 5) %>%\n  ggplot(aes(x = fct_reorder(영화명, 순위), y = 예매매출액)) +\n  geom_col(fill = '#56B4E9', width = 0.6, alpha = 0.9) +\n  scale_y_continuous(expand = c(0, 0),\n                     breaks = seq(0, 20, 5) * 1e+8,\n                     labels = seq(0, 20, 5),\n                     name = '예매매출액 (억원)') +\n  xlab('') +\n  theme_minimal() +\n  theme(axis.ticks.x = element_blank(),\n        panel.grid.major.x = element_blank())\n```\n\n::: {.cell-output-display}\n![](week8_Barplot_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\n### Figure 6.3 - 가로 막대\n\n\n::: {.cell}\n\n```{.r .cell-code}\nboxoffice %>%\n  ggplot(aes(x = fct_reorder(title, rank %>% desc()), y = amount)) +\n  geom_col(fill = '#56B4E9', width = 0.6, alpha = 0.9) +\n  scale_y_continuous(expand = c(0, 0),\n                     breaks = c(0, 2e7, 4e7, 6e7),\n                     labels = c('0', '20', '40', '60'),\n                     name = 'Weekend groos(million USD)') +\n  xlab('') +\n  coord_flip() +\n  theme_minimal() +\n  theme(axis.ticks.x = element_blank(),\n        panel.grid.major.x = element_blank())\n```\n\n::: {.cell-output-display}\n![](week8_Barplot_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\n## 6.2. Grouped and stacked bars : 묶은 막대와 누적 막대\n\n### Figure 6.7\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Data Load\nincome_by_age <- read.csv('./data/income_by_age.csv')\nincome_by_age <- income_by_age %>%\n  mutate(age = age %>% factor(levels = c('15 to 24', '25 to 34',\n                                         '35 to 44', '45 to 54',\n                                         '55 to 64', '65 to 64',\n                                         '> 74')))\n\nincome_df <- income_by_age %>%\n  filter(race %in% c('white', 'asian', 'black', 'hispanic')) %>%\n  mutate(race = fct_relevel(race, c('asian', 'white', 'hispanic', 'black')),\n         race = fct_recode(race, 'Asian' = 'asian', 'Hispanic' = 'hispanic'),\n         age = fct_recode(age, '≥ 75'  = '> 74'))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Color Palette\ncolors_four <- RColorBrewer::brewer.pal(5, 'PuBu')[5:2]\n\n# Plot\nggplot(income_df, aes(x = age, y = median_income, fill = race)) +\n  geom_col(position= 'dodge', alpha = 0.9) +\n  scale_y_continuous(expand = c(0, 0),\n                     name = 'Median Income (USD)',\n                     breaks = seq(0, 10, 2) * 1e+4,\n                     labels = paste0('$', format(seq(0, 10, 2) * 1e+4,\n                                                 big.mark = ',',\n                                                 scientific = FALSE))) +\n  scale_fill_manual(values = colors_four, name = NULL) +\n  xlab('Age (years)') +\n  theme_minimal() +\n  theme(panel.grid.major.x = element_blank(),\n        axis.ticks.x = element_blank())\n```\n\n::: {.cell-output-display}\n![](week8_Barplot_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n### Figure 6.8\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Take  the darkest seven colors from 8-class ColorBrewer palette 'PuBu'\ncolors_seven = RColorBrewer::brewer.pal(8, 'PuBu')[2:8]\n\nggplot(income_df, aes(x = race, y = median_income, fill = age)) +\n  geom_col(position = 'dodge', alpha = 0.9) +\n  scale_y_continuous(expand = c(0, 0),\n                     name = 'Median Income (USD)',\n                     breaks = seq(0, 10, 2) * 1e+4,\n                     labels = paste0('$', format(seq(0, 10, 2) * 1e+4,\n                                                 big.mark = ',',\n                                                 scientific = FALSE))) +\n  scale_fill_manual(values = colors_seven, name = 'Age') +\n  xlab(NULL) +\n  theme_minimal() +\n  theme(panel.grid.major.x = element_blank(),\n        axis.ticks.x = element_blank())\n```\n\n::: {.cell-output-display}\n![](week8_Barplot_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n### Figure 6.9\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(income_df, aes(x = age, y = median_income)) +\n  geom_col(fill ='#56B4E9', alpha = 0.9) +\n  scale_y_continuous(expand = c(0, 0),\n                     name = 'Median Income (USD)',\n                     breaks = seq(0, 10, 2) * 1e+4,\n                     labels = paste0('$', format(seq(0, 10, 2) * 1e+4,\n                                                 big.mark = ',',\n                                                 scientific = FALSE))) +\n  xlab('Age (years)') +\n  facet_wrap(~race, scales = 'free_x') + # 그래프 분할, y축 고정\n  theme_minimal() +\n  theme(panel.grid.major.x = element_blank(),\n        axis.ticks.x = element_blank())  \n```\n\n::: {.cell-output-display}\n![](week8_Barplot_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\n## 6.3 Dot plots and heatmaps : 점 도표와 히트맵\n\n### Figure 6.11\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# install.packages('gapminder')\nlibrary(gapminder) # 국가별 기대수명 자료\n\ndf_Americas <- gapminder %>% filter(year == 2007, continent == 'Americas')\n\nggplot(df_Americas, aes(x = lifeExp, y = fct_reorder(country, lifeExp))) +\n  geom_point(color = '#0072B2', size = 3) +\n  scale_x_continuous(name = 'Life Expectancy (years)',\n                     limits = c(59, 82),\n                     expand = c(0, 0)) +\n  scale_y_discrete(name = NULL, expand = c(0, 0.5)) +\n  theme_minimal() +\n  theme(plot.margin = margin(18, 6, 3, 1.5))\n```\n\n::: {.cell-output-display}\n![](week8_Barplot_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\n### Figure 6.14\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Data Load\ninternet <- read.csv('./data/internet.csv')\n\ncountry_list = c('United States', 'China', 'India', 'Japan', 'Algeria',\n                 'Brazil', 'Germany', 'France', 'United Kingdom', 'Italy',\n                 'New Zealand', 'Canada', 'Mexico', 'Chile', 'Argentina',\n                 'Norway', 'South Africa', 'Kenya', 'Israel', 'Iceland')\n\ninternet_short <- filter(internet, country %in% country_list) %>%\n  mutate(users = ifelse(is.na(users), 0, users))\n\n# 인터넷 사용자 비율이 높은 순서\ninternet_summary <- internet_short %>%\n  filter(year == 2016) %>%\n  arrange(users)\n\n# Levels\ninternet_short <- internet_short %>%\n  filter(year > 1993) %>%\n  mutate(country = factor(country, levels = internet_summary$country))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Visualization\nggplot(internet_short, aes(x = year, y = country, fill = users)) +\n  geom_tile(color = 'white', linewidth = 0.25) +\n  scale_fill_viridis_c(option = 'A', begin = 0.05, end = 0.98, limits = c(0, 100),\n                       name = 'Internet Users / 100 people',\n                       guide = guide_colorbar(direction = 'horizontal',\n                                              label.position = 'bottom',\n                                              title.position = 'top',\n                                              ticks = FALSE,\n                                              barwidth = grid::unit(3.5, 'in'),\n                                              barheight = grid::unit(0.2, 'in'))) +\n  scale_x_continuous(expand = c(0, 0), name = NULL) +\n  scale_y_discrete(name = NULL, position = 'right') +\n  theme_minimal() +\n  theme(axis.line = element_blank(),\n        axis.ticks = element_blank(),\n        panel.grid.major.x = element_blank(),\n        axis.ticks.x =  element_blank(),\n        legend.position = 'top',\n        legend.justification = 'left', \n        legend.title.align = 0.5,\n        legend.title = element_text(size = 10))\n```\n\n::: {.cell-output-display}\n![](week8_Barplot_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\n### Figure 6.15\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 인터넷 사용률이 처음으로 20%를 넘긴 해\ninternet_summary <- internet_short %>%\n  filter(users > 20) %>%\n  group_by(country) %>%\n  summarize(year_min = min(year),\n            users_max = max(users)) %>%\n  arrange(year_min %>% desc(), users_max)\n\n# Levels\ninternet_short <- internet_short%>%\n  filter(year > 1993) %>%\n  mutate(country = factor(country, levels = internet_summary$country))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Visualization\nggplot(internet_short, aes(x = year, y = country, fill = users)) +\n  geom_tile(color = 'white', linewidth = 0.25) +\n  scale_fill_viridis_c(option = 'A', begin = 0.05, end = 0.98, limits = c(0, 100),\n                       name = 'Internet Users / 100 people',\n                       guide = guide_colorbar(direction = 'horizontal',\n                                              label.position = 'bottom',\n                                              title.position = 'top',\n                                              ticks = FALSE,\n                                              barwidth = grid::unit(3.5, 'in'),\n                                              barheight = grid::unit(0.2, 'in'))) +\n  scale_x_continuous(expand = c(0, 0), name = NULL) +\n  scale_y_discrete(name = NULL, position = 'right') +\n  theme_minimal() +\n  theme(axis.line = element_blank(),\n        axis.ticks = element_blank(),\n        panel.grid.major.x = element_blank(),\n        axis.ticks.x =  element_blank(),\n        legend.position = 'top',\n        legend.justification = 'left', \n        legend.title.align = 0.5,\n        legend.title = element_text(size = 10))\n```\n\n::: {.cell-output-display}\n![](week8_Barplot_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n\n## 연습문제\n\n### 1. SW기술자 평균임금\n- SW기술자_평균임금_20220412145301.csv (`fileEncoding = 'CP949'`)\n- 2021년만 시각화\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 1. SW기술자 평균 임금\ndata_sw_raw <- read.csv('./data/SW기술자_평균임금_20220412145301.csv', fileEncoding = 'CP949')\n\n# Figre 6.11 - 2021년 SW기술자 평균임금\ndata_sw_2021 <- data_sw_raw %>% select(직무별, X2021)\n\nggplot(data_sw_2021, aes(x = X2021, y = fct_reorder(직무별, X2021))) +\n  geom_point(color = '#0072B2', size = 3) +\n  scale_x_continuous(name = '평균임금',\n                     breaks = seq(2, 6, 1) * 1e+5,\n                     labels = format(seq(2, 6, 1) * 1e+5,\n                                     big.mark = ',',\n                                     scientific = FALSE),\n                     expand = c(0, 0),\n                     limits = c(1.5, 6.5) * 1e+5) +\n  scale_y_discrete(name = NULL, expand = c(0, 0.5)) +\n  theme_minimal() +\n  theme(plot.margin = margin(18, 6, 3, 1.5))\n```\n\n::: {.cell-output-display}\n![](week8_Barplot_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n\n\n### 2. 연령집단별 자살률\n- 연령집단별_자살률.csv (`fileEncoding = 'UTF-8'`)\n- 2000년~2020년\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 2. 연령집단별 자살률\ndata_rate_raw <- read.csv('./data/연령집단별_자살률.csv')\n\n# 나이, 성별 분리\ndata_rate_melt <- data_rate_raw %>%\n  reshape2::melt(id.vars = '연령집단',\n                 variable.name = '년도',\n                 value.name = '자살률') %>%\n  mutate(년도 = gsub('\\\\D', '', 년도) %>% as.integer(),\n         자살률 = 자살률 %>% as.integer())\n\n\nggplot(data_rate_melt, aes(x = 년도, y = 연령집단, fill = 자살률)) +\n  geom_tile(color = 'white', linewidth = 0.25) +\n  scale_fill_viridis_c(option = 'A', begin = 0.05, end = 0.98, limits = c(0, 130),\n                       name = '연령집단 (인구 십만 명당)',\n                       guide = guide_colorbar(direction = 'horizontal',\n                                              label.position = 'bottom',\n                                              title.position = 'top',\n                                              ticks = FALSE,\n                                              barwidth = grid::unit(3.5, 'in'),\n                                              barheight = grid::unit(0.2, 'in'))) +\n  scale_x_continuous(expand = c(0, 0), name = NULL) +\n  scale_y_discrete(name = NULL, position = 'right') +\n  theme_minimal() +\n  theme(axis.line = element_blank(),\n        axis.ticks = element_blank(),\n        panel.grid.major.x = element_blank(),\n        axis.ticks.x =  element_blank(),\n        legend.position = 'top',\n        legend.justification = 'left', \n        legend.title.align = 0.5,\n        legend.title = element_text(size = 10))\n```\n\n::: {.cell-output-display}\n![](week8_Barplot_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "week8_Barplot_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}