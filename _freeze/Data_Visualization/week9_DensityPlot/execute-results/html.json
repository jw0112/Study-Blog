{
  "hash": "88f871ceb2cade662eb5d916cb3d4ede",
  "result": {
    "markdown": "---\ntitle: 'Density Plot'\nauthor: 'Jinwon Lee'\ndate: '2023-05-08'\ncategories: [Visualization, Code, R]\npage-layout: full\nimage: \"./image/densityplot.png\"\noutput:\n  prettydoc::html_pretty:\n    theme: architect\n    highlight: github\neditor_options: \n  chunk_output_type: console\nmainfont: NanumGothic\n---\n\n\n\n\n# 7. Visualizing distributions : 히스토그램과 밀도 도표\n\n## 7.1. Visualizing a single distribution: 단일 분포 상태의 시각화\n\n### Figure 7.1\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntitanic_all <- read.csv('./data/titanic_all.csv')\n\ntitanic <- titanic_all %>%\n  mutate(sex = factor(sex, levels = c('male', 'female')))\n\ntitanic %>% filter(!is.na(age)) %>%\n  ggplot(aes(x = age)) +\n  geom_histogram(breaks = seq(0, 75, 5),color = 'white', fill = '56B4E9') +\n  scale_y_continuous(expand = c(0, 0),\n                     breaks = (0:5) * 25) +\n  scale_x_continuous(expand = c(0, 0),\n                     limits = c(0, 75),\n                     name = 'Age (years)') +\n  theme_light() +\n  theme(panel.border = element_blank(),\n        axis.line.x = element_blank(),\n        panel.grid.major.x = element_blank(),\n        panel.grid.minor.x = element_blank(),\n        panel.grid.minor.y = element_blank(),\n        plot.margin  = margin(3, 7, 3, 1.5))\n```\n\n::: {.cell-output-display}\n![](week9_DensityPlot_files/figure-html/unnamed-chunk-1-1.png){width=672}\n:::\n:::\n\n\n### Figure 7.3\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(titanic, aes(x = age)) +\n  geom_density(fill = '#56B4E9',\n               color = '#01587A',\n               bw = 2, kernel = 'gaussian') +\n  scale_y_continuous(limits = c(0, 0.046),\n                     expand = c(0, 0),\n                     name = 'Density') +\n  scale_x_continuous(name ='Age (years)',\n                     limits = c(0, 75),\n                     expand = c(0, 0)) +\n  theme_light() +\n  theme(panel.border = element_blank(),\n        axis.line.x = element_blank(),\n        panel.grid.major.x = element_blank(),\n        panel.grid.minor.x = element_blank(),\n        panel.grid.minor.y = element_blank(),\n        plot.margin  = margin(3, 7, 3, 1.5))\n#> Warning: Removed 557 rows containing non-finite values (`stat_density()`).\n```\n\n::: {.cell-output-display}\n![](week9_DensityPlot_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\n### Figure 7.8\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(titanic, aes(x = age,\n                    y = after_stat(count),\n                    fill = sex, color = sex)) +\n  geom_density(bw = 2,\n               kernel = 'gaussian',\n               alpha = 0.5) +\n  scale_y_continuous(expand = c(0, 0),\n                     name = 'Scaled Density') +\n  scale_x_continuous(name = 'Age (years)',\n                     limits = c(0, 75),\n                     expand = c(0, 0)) +\n  scale_fill_manual(values = c('#0072B2', '#D55E00'),\n                    name = 'Gender') +\n  scale_color_manual(values = colorspace::darken(c('#0072B2','#D55E00'), 0.5),\n                     name = 'Gender') +\n  theme_light() +\n  theme(panel.border = element_blank(),\n        axis.line.x = element_blank(),\n        panel.grid.major.x = element_blank(),\n        panel.grid.minor.x = element_blank(),\n        panel.grid.minor.y = element_blank(),\n        legend.position = c(.8, .8),\n        plot.margin  = margin(3, 7, 3, 1.5))\n#> Warning: Removed 557 rows containing non-finite values (`stat_density()`).\n```\n\n::: {.cell-output-display}\n![](week9_DensityPlot_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\n### Figure 7.9\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(titanic, aes(x = age, y = after_stat(count))) +\n  geom_density(data = select(titanic, -sex),\n               aes(fill = 'all passengers'),\n                   color = 'transparent') +\n  geom_density(aes(fill = sex), bw = 2, color = 'transparent') +\n  scale_y_continuous(expand = c(0, 0), name = 'Scaled Density') +\n  scale_x_continuous(name = 'Passenger Age (years)',\n                     limits = c(0, 75), expand = c(0, 0)) +\n  scale_fill_manual(values = c('#B3B3B3A0','#D55E00', '#0072B2'),\n                    breaks = c('all passengers', 'male', 'female'),\n                    labels = c('all passengers', 'males', 'females'),\n                    name = NULL,\n                    guide = guide_legend(direction = 'horizontal')) +\n  theme_light() +\n  theme(panel.border = element_blank(),\n        axis.line.x = element_blank(),\n        panel.grid.major.x = element_blank(),\n        panel.grid.minor.x = element_blank(),\n        panel.grid.minor.y = element_blank(),\n        strip.background = element_rect(fill= 'white'),\n        strip.text.x = element_text(colour = 'black'),\n        legend.position = 'bottom')\n#> Warning: Removed 557 rows containing non-finite values (`stat_density()`).\n#> Removed 557 rows containing non-finite values (`stat_density()`).\n```\n\n::: {.cell-output-display}\n![](week9_DensityPlot_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\n### Figure 7.10\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngender_counts <- data.frame(age = (1:25) * 3 -  1.5,\n                            male = hist(filter(titanic, sex == 'male')$age,\n                                        breaks = (0:25) *3 + .01,\n                                        plot = FALSE)$counts,\n                            female = hist(filter(titanic, sex == 'female')$age,\n                                        breaks = (0:25) *3 + .01,\n                                        plot = FALSE)$counts) %>%\n  reshape2::melt('age', variable.name = 'gender', value.name = 'count')\n\nggplot(gender_counts, aes(x = age,\n                          y = ifelse(gender == 'male', -1, 1) * count,\n                          fill = gender)) +\n  geom_col() +\n  scale_x_continuous(name = 'Age (years)',\n                     limits = c(0, 75),\n                     expand = c(0, 0)) +\n  scale_y_continuous(name = 'Count',\n                     breaks = (-2:1) * 20,\n                     labels=c('40', '20', '0', '20')) +\n  scale_fill_manual(values = c('#0072B2', '#D55E00'),\n                    guide = 'none') +\n  cowplot::draw_text(x = 70, y = -39, 'male', hjust = 0) +\n  cowplot::draw_text(x = 70, y = 21, 'female', hjust = 0) +\n  coord_flip() +\n  theme_light() +\n  theme(panel.border = element_blank(),\n        panel.grid.minor.x = element_blank(),\n        panel.grid.minor.y = element_blank(),\n        axis.title.x = element_text(hjust = 0.61))\n```\n\n::: {.cell-output-display}\n![](week9_DensityPlot_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n### Figure 7.11\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(iris, aes(x = Sepal.Length, colour = Species, fill = Species)) +\n  geom_density(alpha = .3) +\n  xlab('Petal Length (cm)') +\n  ylab('Density') +\n  ggtitle('Iris Density Plot') +\n  theme_light() +\n  theme(panel.border = element_blank(),\n        panel.grid.minor.x = element_blank(),\n        panel.grid.minor.y = element_blank(),\n        legend.position = c(.82, .78))\n```\n\n::: {.cell-output-display}\n![](week9_DensityPlot_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n# Practice\n\n## 7.1 Visualizing a single distribution - 단일 분포 상태의 시각화\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 공공데이터포털 > 행정안전부_지역별(법정동) 성별 연령별 주민등록 인구수\n# https://www.data.go.kr/data/15099158/fileData.do\ndata_age_raw <- read.csv('./data/행정안전부_지역별(법정동) 성별 연령별 주민등록 인구수_20230430.csv', fileEncoding = 'CP949')\n\n# 자료형 변경\ndata_age_raw$법정동코드 <- data_age_raw$법정동코드 %>% as.character() # numeric -> character\n\n# Reshape\nmeasure_col <- names(data_age_raw)[10 : ncol(data_age_raw)]\n\ndata_age_melt <- data_age_raw %>% \n  select(-기준연월, -(시군구명:여자)) %>%\n  filter(시도명 == '대전광역시') %>% \n  reshape2::melt(id.vars = c('법정동코드', '시도명'),\n                 measure.vars = measure_col,\n                 variable.name = '나이_성별',\n                 value.name = '인구수') %>% \n  mutate(나이_성별 = as.character(나이_성별)) # factor -> character\n\n# 나이 성별 분리\ndata_age_melt <- data_age_melt %>% \n  mutate(age = gsub('\\\\D','', 나이_성별) %>% as.integer(),\n         sex = substring(나이_성별, nchar(나이_성별) - 1, nchar(나이_성별)))\n\n# 연령대\nage_len <- 5\ndata_age_cat <- data_age_melt %>%\n  mutate(age_cat = cut(age + 0.1, breaks = seq(0, 120, age_len), labels = F)) %>%\n  group_by (age_cat) %>%\n  summarise(count = sum (인구수))\n\ndata_age_cat$age_cat <- age_len*(data_age_cat$age_cat - 1) + age_len/2\n```\n:::\n\n\n### Figure 7.1\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Histogram\nggplot(data_age_cat, aes(x = age_cat, y = count/1000)) +\n  geom_col(fill = '#56B4E9') +\n  scale_y_continuous (expand = c(0, 0), name = '인구(천)') +\n  scale_x_continuous (expand = c(0, 0), name = '연령(세)') +\n  theme_light() +\n  theme(panel.border = element_blank(),\n        axis.line.x = element_blank(),\n        panel.grid.major.x = element_blank(),\n        panel.grid.minor.x = element_blank(),\n        panel.grid.minor.y = element_blank(),\n        plot.margin = margin(3, 7, 3, 1.5))\n```\n\n::: {.cell-output-display}\n![](week9_DensityPlot_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\n### Figure 7.3\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Density\nggplot(data_age_cat, aes(x = age_cat, weight = count)) +\n  geom_density (fill = '#56B4E9', bw = 3) +\n  scale_y_continuous(expand = c(0, 0), name = '인구(밀도)') +\n  scale_x_continuous(expand = c(0, 0), name = '연령(세)') +\n  theme_light() +\n  theme(panel.border= element_blank(),\n        axis.line.x = element_blank(),\n        panel.grid.major.x = element_blank(),\n        panel.grid.minor.x = element_blank(),\n        panel.grid.minor.y = element_blank(),\n        plot.margin = margin(3, 7, 3, 1.5))\n```\n\n::: {.cell-output-display}\n![](week9_DensityPlot_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\n## 7.2 Visualizing multiple distributions at the same time - 여러 분포 상태를 하나의 도표로 시각화\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 연령대, 성별\nage_len <- 5\ndata_age_cat <- data_age_melt %>%\n  mutate(age_cat = cut(age + 0.1, breaks = seq(0, 120, age_len), labels = F)) %>%\n  group_by(age_cat, sex) %>%\n  summarise(count = sum(인구수))\n#> `summarise()` has grouped output by 'age_cat'. You can override using the\n#> `.groups` argument.\n\ndata_age_cat$age_cat <- age_len * (data_age_cat$age_cat - 1) + age_len/2\n```\n:::\n\n\n### Figure 7.8\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Density\nggplot(data_age_cat, aes(x = age_cat, weight = count, fill = sex, color = sex)) +\n  geom_density(bw = 3, alpha = 0.5) +\n  scale_y_continuous(expand = c(0, 0), name = '인구(밀도)') +\n  scale_x_continuous(expand = c(0, 0), name= '연령(세)') +\n  scale_fill_manual(values = c('#0072B2', '#D55E00'), name = '성별') +\n  scale_color_manual(values = c('#003A5E', '#6D2D00'), name = '성별') + \n  theme_light () +\n  theme(panel.border = element_blank(),\n        axis.line.x = element_blank(),\n        panel.grid.major.x = element_blank(),\n        panel.grid.minor.x = element_blank(),\n        panel.grid.minor.y = element_blank(),\n        legend.position = c(.8, .8),\n        plot.margin = margin(3, 7, 3, 1.5))\n```\n\n::: {.cell-output-display}\n![](week9_DensityPlot_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n\n### Figure 7.10\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data_age_cat, aes(x = age_cat, y = ifelse(sex == '남자', -1, 1) *count, fill = sex)) +\n  geom_col() +\n  scale_x_continuous(name = 'Age (years)', expand = c(0, 0)) +\n  scale_y_continuous(name = 'Count', breaks = (-3:3) * 20000,\n                     labels = format(abs((-3:3) * 20000), big.mark = ',')) +\n  scale_fill_manual(values = c('#0072B2', '#D55E00'), guide = 'none') +\n  draw_text(x = 100, y = -40000, 'male', hjust = 0.5) +\n  draw_text(x = 100, y = 40000, 'female', hjust = 0.5) +\n  coord_flip() +\n  theme_light() +\n  theme(panel.border= element_blank(),\n        panel.grid.minor.x = element_blank(),\n        panel.grid.minor.y = element_blank())\n```\n\n::: {.cell-output-display}\n![](week9_DensityPlot_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "week9_DensityPlot_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}