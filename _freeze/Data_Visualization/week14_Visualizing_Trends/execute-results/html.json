{
  "hash": "82fc8afccc92ec61f1bb696f1284cec0",
  "result": {
    "markdown": "---\ntitle: ' Visualizing Trends'\nauthor: 'Jinwon Lee'\ndate: '2023-06-07'\ncategories: [Visualization, Code, R]\npage-layout: full\nimage: \"./image/trend.png\"\noutput:\n  prettydoc::html_pretty:\n    theme: architect\n    highlight: github\neditor_options: \n  chunk_output_type: console\nmainfont: NanumGothic\n---\n\n\n# 14. Visualizing Trends - 추세의 시각화\n\n\n\n\n\n## 14.1 Smoothing - 평활화를 통한 데이터 보정\n\n\n::: {.cell}\n\n```{.r .cell-code}\nload('./data/dow_jones_industrial.rda')\n\ndow_jones_industrial %>% sapply(class)\n#>      date      open      high       low     close    volume \n#>    \"Date\" \"numeric\" \"numeric\" \"numeric\" \"numeric\" \"integer\"\ndow_jones_industrial %>% head()\n#> # A tibble: 6 × 6\n#>   date        open  high   low close   volume\n#>   <date>     <dbl> <dbl> <dbl> <dbl>    <int>\n#> 1 1985-01-29 1278. 1295. 1267. 1293. 13560000\n#> 2 1985-01-30 1297. 1305. 1279. 1288. 16820000\n#> 3 1985-01-31 1283. 1293. 1273. 1287. 14070000\n#> 4 1985-02-01 1277. 1286. 1270. 1278. 10980000\n#> 5 1985-02-04 1272. 1295. 1269. 1290. 11630000\n#> 6 1985-02-05 1294. 1301. 1279. 1285. 13800000\n```\n:::\n\n\n### Figure 14.1\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndow_jones_industrial %>%\n  filter(date >= '2008/12/31' & date <= '2010/01/10') %>%\n  ggplot(aes(date, close)) +\n  geom_line(linewidth = 0.75) +\n  ylab('Dow Jones Industrial Average') +\n  scale_x_date(name = NULL, date_labels = '%Y년 %b월') +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](week14_Visualizing_Trends_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\n### Figure 14.3\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndow_jones_industrial %>%\n  filter(date >= '2008/12/31' & date <= '2010/01/10') %>%\n  ggplot(aes(date, close, color = 'close')) +\n  geom_line(linewidth = 0.75) +\n  geom_smooth(aes(color = 'smooth'), size = 1, na.rm = T, se = F) +\n  scale_color_manual(name = NULL,\n                     values = c(close = '#000000', smooth = '#0072b2'),\n                     labels = c('Close', 'LOESS Smoother')) +\n  ylab('Dow Jones Industrial Average') +\n  scale_x_date(name = NULL, date_labels = '%Y년 %b월') +\n  theme_minimal() +\n  theme(legend.position = c(0.8, 0.4))\n#> Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.\n#> ℹ Please use `linewidth` instead.\n#> `geom_smooth()` using method = 'loess' and formula = 'y ~ x'\n```\n\n::: {.cell-output-display}\n![](week14_Visualizing_Trends_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# span : Controls the amount of smoothing for the default loess smoother.\ndow_jones_industrial %>%\n  filter(date >= '2008/12/31' & date <= '2010/01/10') %>%\n  ggplot(aes(date, close, color = 'close')) +\n  geom_line(linewidth = 0.75) +\n  geom_smooth(aes(color = 'smooth'), size = 1, na.rm = T, se = F, span = 0.3) +\n  scale_color_manual(name = NULL,\n                     values = c(close = '#000000', smooth = '#0072b2'),\n                     labels = c('Close', 'LOESS Smoother')) +\n  ylab('Dow Jones Industrial Average') +\n  scale_x_date(name = NULL, date_labels = '%Y년 %b월') +\n  theme_minimal() +\n  theme(legend.position = c(0.8, 0.4))\n#> `geom_smooth()` using method = 'loess' and formula = 'y ~ x'\n```\n\n::: {.cell-output-display}\n![](week14_Visualizing_Trends_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# gam : Generalized Additive Models - Cubic Regression Splines with 5 knots.\ndow_jones_industrial %>%\n  filter(date >= '2008/12/31' & date <= '2010/01/10') %>%\n  ggplot(aes(date, close, color = 'close')) +\n  geom_line(linewidth = 0.75) +\n  geom_smooth(aes(color = 'smooth'), size = 1, na.rm = T, se = F,\n              method = 'gam', formula = y ~ s(x, k = 5, bs = 'cr')) +\n  scale_color_manual(name = NULL,\n                     values = c(close = '#000000', smooth = '#0072b2'),\n                     labels = c('Close', 'Cubic Regression Splines')) +\n  ylab('Dow Jones Industrial Average') +\n  scale_x_date(name = NULL, date_labels = '%Y년 %b월') +\n  theme_minimal() +\n  theme(legend.position = c(0.8, 0.4))\n```\n\n::: {.cell-output-display}\n![](week14_Visualizing_Trends_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# gam : Generalized Additive Models - Thin-Plate Regression Spline with 3 knots.\ndow_jones_industrial %>%\n  filter(date >= '2008/12/31' & date <= '2010/01/10') %>%\n  ggplot(aes(date, close, color = 'close')) +\n  geom_line(linewidth = 0.75) +\n  geom_smooth(aes(color = 'smooth'), size = 1, na.rm = T, se = F,\n              method = 'gam', formula = y ~ s(x, k = 3)) +\n  scale_color_manual(name = NULL,\n                     values = c(close = '#000000', smooth = '#0072b2'),\n                     labels = c('Close', 'Thin-Plate Regression Spline')) +\n  ylab('Dow Jones Industrial Average') +\n  scale_x_date(name = NULL, date_labels = '%Y년 %b월') +\n  theme_minimal() +\n  theme(legend.position = c(0.8, 0.4))\n```\n\n::: {.cell-output-display}\n![](week14_Visualizing_Trends_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# gam : Generalized Additive Models - Gaussian Process Spline with 3 knots.\ndow_jones_industrial %>%\n  filter(date >= '2008/12/31' & date <= '2010/01/10') %>%\n  ggplot(aes(date, close, color = 'close')) +\n  geom_line(linewidth = 0.75) +\n  geom_smooth(aes(color = 'smooth'), size = 1, na.rm = T, se = F,\n              method = 'gam', formula = y ~ s(x, k = 6, bs = 'gp')) +\n  scale_color_manual(name = NULL,\n                     values = c(close = '#000000', smooth = '#0072b2'),\n                     labels = c('Close', 'Gaussian Process Spline')) +\n  ylab('Dow Jones Industrial Average') +\n  scale_x_date(name = NULL, date_labels = '%Y년 %b월') +\n  theme_minimal() +\n  theme(legend.position = c(0.8, 0.4))\n```\n\n::: {.cell-output-display}\n![](week14_Visualizing_Trends_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\n## 14.2 Showing Trends with a Defined Functional Form - 정의된 함수 형식으로 추세 시각화\n\n### Figure 14.7\n\n\n::: {.cell}\n\n```{.r .cell-code}\nload('./data/blue_jays.rda')\n\nggplot(blue_jays, aes(Mass, Head, fill = KnownSex, color = KnownSex)) +\n  geom_point(pch = 21, color = 'white', size = 3) +\n  geom_smooth(method = 'lm', linewidth = 0.75, se = F, fullrange = T) +\n  xlab('Body Mass (g)') +\n  ylab('Head Length (mm)') +\n  scale_fill_manual(values = c(F = '#D55E00', M = '#007282'), \n                    breaks = c('F', 'M'),\n                    labels = c('Female Birds   ', 'Male Birds'),\n                    name = NULL,\n                    guide = guide_legend(direction = 'horizontal')) +\n  scale_color_manual(values = c(F = '#D55E00', M = '#007282'), \n                     breaks = c('F', 'M'),\n                     labels = c('Female Birds   ', 'Male Birds'),\n                     name = NULL) +\n  theme_minimal() +\n  theme(legend.position = 'top',\n        legend.justification = 'right')\n#> `geom_smooth()` using formula = 'y ~ x'\n```\n\n::: {.cell-output-display}\n![](week14_Visualizing_Trends_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\n## 14.3 Detrending and Time-Series Decomposition - 추세 제거와 시계열 데이터 분해\n\n### Figure 14.12\n\n\n::: {.cell}\n\n```{.r .cell-code}\nload('./data/CO2.rda')\n\nCO2 %>% \n  ggplot(aes(date_dec, co2_interp)) +\n  geom_line(linewidth = 0.75, color = '#0072B2') +\n  ylab(parse(text = '`CO`[2]*` Concentration (ppm)`')) +\n  xlab(NULL) +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](week14_Visualizing_Trends_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n\n```{.r .cell-code}\n\nCO2 %>%\n  mutate(date = as.Date(paste(year, month, 1, sep = '-'))) %>%\n  ggplot(aes(date, co2_interp)) +\n  geom_line(linewidth = 0.75, color = '#0072B2') +\n  ylab(parse(text = '`CO`[2]*` Concentration (ppm)`')) +\n  scale_x_date(name = NULL, date_labels = '%Y') +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](week14_Visualizing_Trends_files/figure-html/unnamed-chunk-9-2.png){width=672}\n:::\n:::\n\n\n### Figure 14.13\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Use complete years only\nCO2_complete <- filter(CO2, year >= 1959, year < 2018)\n\n# Convert to time series object\nCO2_ts <- ts(data = CO2_complete$co2_interp,\n             start = 1959, end = c(2017, 12), frequency = 12)\n\n# Detrend via STL method\nCO2_stl <- stl(CO2_ts, s.window = 7)\nCO2_detrended <- mutate(CO2_complete,\n                        `monthly average` = co2_interp,\n                        `seasonal fluctuations` = CO2_stl$time.series[, 'seasonal'],\n                        `long-term trend` = CO2_stl$time.series[, 'trend'],\n                        `remainder` = CO2_stl$time.series[, 'remainder'])\n\nfacet_labels <- c('monthly average', 'long-term trend', 'seasonal fluctuations', 'remainder')\n\nggp <- CO2_detrended %>%\n  select(date_dec, `monthly average` : remainder) %>%\n  tidyr::gather('variable', 'value', -date_dec) %>%\n  mutate(variable = factor(variable, levels = facet_labels)) %>%\n  filter(date_dec >= 1989) %>%\n  ggplot(aes(date_dec, value)) +\n  geom_line(linewidth = 0.75, color = '#007282') +\n  facet_wrap(facets = ~variable, ncol =  1, scales = 'free') +\n  theme_minimal()\n#> Warning: attributes are not identical across measure variables; they will be\n#> dropped\n\nggp\n```\n\n::: {.cell-output-display}\n![](week14_Visualizing_Trends_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::",
    "supporting": [
      "week14_Visualizing_Trends_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}